#!/bin/bash

FILE=~/.todo_list.todo

# checking flags and setting mode based on these flags
if [ "$#" -ne 0 ]; then
    case "$1" in
        "--create")     mode=create ;;
        "-c")           mode=create ;;
        "--help")       mode=help ;;
        "-h")           mode=help ;;
        *)              mode=help ;;
    esac
else
    mode=list
fi

# loading configuration from /etc/todo_list.conf
typeset -A config
config=(
    [todo_count]="0"
)
if [ -f $FILE ]; then
    while read line; do
        if echo $line | grep -F = &>/dev/null; then
            varname=$(echo "$line" | cut -d '=' -f 1)
            config[$varname]=$(echo "$line" | cut -d '=' -f 2-)
        fi
    done < $FILE
fi

case "$mode" in
    "help") # Displaying help message
        echo "Usage: todo [options <arg>]"
        echo "Options:"
        echo "    -c, --create <text>       - creates new entry"
        echo "    -h, --help                - displays help message"
        ;;
    "list") # Showing list of ToDos
        echo "To do:"
        for i in $(seq 1 ${config[todo_count]}); do
            if [ "${config[todo_status_$i]}" = "TODO" ]; then
                echo -e "  [ ] $i.\t\t ${config[todo_$i]}"
            fi
        done
        echo
        echo "Doing:"
        for i in $(seq 1 ${config[todo_count]}); do
            if [ "${config[todo_status_$i]}" = "DOING" ]; then
                echo -e "  [O] $i.\t\t ${config[todo_$i]}"
            fi
        done
        echo
        echo "Done:"
        for i in $(seq 1 ${config[todo_count]}); do
            if [ "${config[todo_status_$i]}" = "DONE" ]; then
                echo -e "  [X] $i.\t\t ${config[todo_$i]}"
            fi
        done
        echo
        ;;
    "create") # Creating new element on list
        index=${config[todo_count]}
        index=$((index+1))
        config["todo_$index"]="${@:2}"
        config["todo_status_$index"]="TODO"
        config[todo_count]="$index"
        echo "Created '${@:2}' entry"
        ;;
esac

touch $FILE
echo "" > $FILE
for index in ${!config[*]}; do
    echo "$index=${config[$index]}" >> $FILE
done
